#!/usr/local/bin/perl -w
# programmer: zhangqp
# e-mail:zhangqp@genomics.org.cn

if (@ARGV<3) {
	print  "programm refGene.txt gene.list file_out \n";
	exit;
}
($file_refgene,$file_list,$file_out) =@ARGV;

open LIST,"$file_list" || die"$!";
open OUT,">$file_out" || die"$!";
open REFGENE,"$file_refgene" || die"$!";


# AB005216
# AB006589
# AB023191
# AB023420
# AC005393
# AF022375
# AF042162
# AF042163

while (<LIST>) {
	chomp;
	$mark{$_} = 5;
}

# NM_007336	chr3	+	38041320	38124854	38041341	38098007	36	38041320,38047658,38061857,38064284,38064696,38065956,38086273,38087389,38088356,38090411,38094905,38095720,38098003,38098684,38099297,38099622,38099859,38102401,38109699,38110520,38111547,38112214,38113792,38114325,38116457,38117098,38118568,38118888,38119090,38119323,38119642,38119921,38122563,38123743,38124186,38124404,	38041752,38047809,38061968,38064484,38064917,38066035,38086361,38087563,38088493,38090504,38094996,38095883,38098062,38098853,38099391,38099753,38100018,38102541,38109853,38110631,38111678,38112397,38113863,38114477,38116576,38117169,38118774,38119005,38119216,38119418,38119727,38120140,38122725,38123897,38124310,38124854,
# NM_007337	chr3	+	38041320	38124854	38041341	38124721	36	38041320,38047658,38061857,38064284,38064696,38065956,38086273,38087389,38088356,38090411,38094905,38095720,38096994,38098003,38098684,38099297,38099622,38099859,38102401,38109699,38110520,38111547,38112214,38113792,38114325,38116457,38117098,38118568,38118888,38119090,38119323,38119642,38119921,38122563,38123743,38124404,	38041752,38047809,38061968,38064484,38064917,38066035,38086361,38087563,38088493,38090504,38094996,38095883,38097187,38098062,38098853,38099391,38099753,38100018,38102541,38109853,38110631,38111678,38112397,38113863,38114477,38116576,38117169,38118774,38119005,38119216,38119418,38119727,38120140,38122725,38123897,38124854,



# @NM_004466,13,1
# >NM_004466_0,89748887,89748912
# >NM_004466_1,89748936,89749464
# >NM_004466_2,89799015,89799177
# >NM_004466_3,90043441,90044136
# >NM_004466_4,90078786,90078920
# >NM_004466_5,90106549,90106675
# >NM_004466_6,90258191,90258312
# >NM_004466_7,90495083,90495243
# >NM_004466_8,91216535,91217486
# @NM_000784,2,-1
# >NM_000784_0,219849244,219849700
# >NM_000784_1,219876839,219877030

while (<REFGENE>) {
	chomp;
	@s = split /\t/,$_;
	if (exists $mark{$s[0]}) {
		$strand = $s[2];
		if ($strand eq "+") {
			$new_strand = "1";
		}
		else {
			$new_strand = "-1";
		}
		$chr = $s[1];
		if ($chr =~/chr(.*)/) {
			$new_chr = $1;
		}
		$gene = $s[0];
		$exon_num = $s[7];
		$exon_start = $s[8];
		$exon_end = $s[9];
		@s_exon_start = split ",",$exon_start;
		@s_exon_end = split ",",$exon_end;
		print OUT "\@$gene,$new_chr,$new_strand\n";
		for (my $k = 0;$k< $exon_num;$k++) {
			$exon_name = $gene."_".$k;
			$new_exon_start = $s_exon_start[$k]+1;
			$new_exon_end = $s_exon_end[$k];
			print OUT ">$exon_name,$new_exon_start,$new_exon_end\n";
		}

	}
}

