#!/usr/local/bin/perl -w
# programmer: zhangqp
# e-mail:zhangqp@genomics.org.cn
# 同一个pep比到>3个bac,drop~[只要比到，暂时不考虑参数]
# <0.1 >0.9 丢掉

if (@ARGV<2) {
	print  "programm file_in file_out \n";
	exit;
}
($file_in,$file_out) =@ARGV;

open IN,"$file_in" || die"$!";
open OUT,">$file_out" || die"$!";


#ENSP00000201943	599	57	412	-	bsbm	90090	1000	8081	6	430	57,105;98,138;264,302;300,352;351,383;369,412;	8081,7935;7029,6907;5006,4890;4752,4594;1616,1518;1131,1000;	-83;-88;-74;-101;-66;-69;
#ENSP00000345461	523	57	523	-	bsbm	90090	799	8081	6	482	57,105;98,138;308,346;344,396;395,427;413,523;	8081,7935;7029,6907;5006,4890;4752,4594;1616,1518;1131,799;	-83;-88;-74;-101;-66;-112;
#ENSP00000225430	196	2	143	+	bsbm	90090	16707	19229	4	265	2,39;39,80;78,119;118,143;	16707,16820;17899,18024;18665,18790;19152,19229;	+78;+87;+56;+55;
#ENSP00000327509	411	19	411	-	bsbm	90090	25738	30851	4	326	19,140;133,164;281,314;377,411;	30851,30489;30014,29919;27395,27294;25842,25738;	-132;-71;-64;-68;
#ENSP00000327509	411	1	36	-	bsbm	90090	37419	37526	1	66	1,36;	37526,37419;	-66;
#ENSP00000264658	436	54	436	-	bsbm	90090	65393	87711	9	654	54,78;110,133;133,164;164,208;208,232;233,276;302,370;371,401;401,436;	87711,87637;86297,86226;78586,78491;76956,76822;75523,75449;72830,72699;67248,67036;67034,66942;65500,65393;	-57;-54;-66;-97;-56;-96;-89;-66;-81;
#ENSP00000269122	1675	14	1661	+	bsbl	78559	20766	55635	23	2597	14,91;84,173;174,228;227,268;264,324;321,389;389,444;459,508;508,549;542,595;595,649;650,710;708,764;854,933;930,974;973,1022;1022,1093;1084,1164;1148,1201;1188,1291;1292,1398;1610,1643;1635,1661;	20766,20999;23596,23865;24379,24543;26733,26858;27249,27431;30101,30307;30924,31091;33143,33292;33880,34005;34796,34957;35209,35373;35508,35690;37076,37246;44167,44406;46781,46915;48022,48171;48397,48609;48778,49011;49416,49577;49743,50180;50276,50728;53418,53519;55555,55635;	+139;+188;+110;+87;+125;+133;+116;+100;+89;+101;+115;+123;+120;+173;+91;+98;+124;+132;+110;+173;+200;+57;+61;
#ENSP00000337494	179	1	179	-	bsbl	78559	61133	61669	1	310	1,179;	61669,61133;	-310;
#ENSP00000311866	246	97	195	-	bsaz	77127	41728	42024	1	68	97,195;	42024,41728;	-68;
#ENSP00000311866	246	88	226	-	bsbj	71131	65252	65688	2	68	88,124;128,226;	65688,65578;65569,65252;	-33;-35;


while (<IN>) {
	chomp;
	@s =split/\t/,$_;
	${$bac{$s[0]}}{$s[5]} = 1;
}


foreach my $key (keys %bac) {
	%hash = %{$bac{$key}};
	$num = scalar keys %hash;
	$num{$key} = $num;
	print  "$key\t$num{$key}\n";
}

close IN;
open IN,"$file_in" || die"$!";

while (<IN>) {
	chomp;
	@s = split /\t/,$_;
	if ($num{$s[0]}<=3) {
		if (($s[3]-$s[2]+1)/$s[1]>0.25) {
			unless(($s[3]-$s[2]+1)/$s[1]>0.9  && $s[9] ==1){
				print OUT "$_\n";
			}
		}
	}
}





