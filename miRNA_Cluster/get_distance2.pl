#!/usr/bin/perl -w
use strict;

if (@ARGV < 2) {
    print "perl *.pl file_in file_out \n";
    exit;
}
my ($file_in,$file_out) = @ARGV;
#
#140	C_70733	C_787889 C_802930 C_678992 C_698395 C_664496 C_716149 C_791610 C_771103 C_783745 C_771543 C_790070 C_664102 C_685732 C_771051 C_784139 C_800657 C_750393 C_712739 C_745028 C_662712 C_700353 C_703345 C_681249 C_752074 C_779335 C_689797 C_692012 C_680823 C_765646 C_770070 C_687656 C_757189 C_769320 C_746878 C_774254 C_699648 C_749264 C_749140 C_792047 C_695058 C_736301 C_727206 C_708696 C_776507 C_720196 C_727069 C_665498 C_673890 C_739918 C_770251 C_739912 C_777687 C_708101 C_767124 C_694088 C_785128 C_708096 C_764336 C_791014 C_746282 C_768987 C_693233 C_780494 C_781932 C_708312 C_792528 C_782755 C_714353 C_776506 C_733403 C_740428 C_713555 C_700197 C_675353 C_751848 C_694956 C_694961 C_693091 C_667153 C_799139 C_791041 C_698188 C_679318 C_720207 C_674245 C_786250 C_786523 C_694176 C_672558 C_790052 C_712889 C_661605 C_702399 C_690382 C_795872 C_786765 C_682705 C_684603 C_772863 C_785151 C_751786 C_781599 C_774859 C_775879 C_776913 C_757337 C_717495 C_715866 C_724630 C_678179 C_680876 C_665509 C_665532 C_740280 C_786150 C_769530 C_694094 C_664310 C_758201 C_760478 C_669528 C_777155 C_663856 C_801812 C_741197 C_661613 C_700968 C_781939 C_768008 C_669084 C_776544 C_755886 C_800152 C_795673 C_688836 C_784291 C_663112 C_751437 C_669315 C_667606
#149	C_70734	C_798439 C_800160 C_798990 C_800157 C_799855 C_801809 C_800490 C_802137 C_799658 C_800681 C_800729 C_801591 C_799515 C_800545 C_799241 C_799800 C_802134 C_798125 C_799024 C_797916 C_799291 C_798433 C_802963 C_801844 C_800778 C_800165 C_800585 C_803201 C_798234 C_803124 C_801951 C_800668 C_798222 C_802837 C_798783 C_798679 C_799948 C_801530 C_800050 C_799374 C_799410 C_802577 C_799308 C_800613 C_801895 C_801448 C_802966 C_798705 C_803680 C_803172 C_799817 C_800350 C_798065 C_799071 C_798715 C_799551 C_799577 C_803079 C_799972 C_802273 C_803327 C_798658 C_800469 C_799267 C_798363 C_800373 C_803581 C_800081 C_799590 C_798877 C_798532 C_801721 C_798216 C_800678 C_802286 C_798638 C_799555 C_801430 C_802088 C_798748 C_799769 C_799111 C_798248 C_799654 C_801481 C_803310 C_800055 C_798179 C_800171 C_797909 C_798282 C_800017 C_801833 C_800272 C_798887 C_799956 C_800814 C_798647 C_799931 C_801642 C_799057 C_799379 C_799663 C_799764 C_802630 C_801619 C_798492 C_798184 C_798857 C_800394 C_799287 C_803580 C_799497 C_799965 C_799983 C_803285 C_800203 C_801648 C_798411 C_802945 C_799755 C_799996 C_802731 C_801161 C_803588 C_798680 C_799990 C_802183 C_798346 C_801924 C_798460 C_800398 C_799558 C_800499 C_798308 C_798986 C_799234 C_799790 C_799194 C_799994 C_800511 C_801207 C_799429 C_799811 C_798073 C_798860 C_801461 C_798838 C_800475
#154	C_70735	C_771067 C_760553 C_670868 C_710476 C_742416 C_627403 C_200510 C_183451 C_605499 C_715202 C_566596 C_187426 C_725581 C_726127 C_425630 C_291375 C_303731 C_617854 C_669494 C_727056 C_785172 C_726977 C_630829 C_738076 C_665939 C_635465 C_732924 C_665777 C_798582 C_785133 C_584399 C_760730 C_570007 C_760610 C_596066 C_233168 C_665145 C_725613 C_633503 C_194002 C_660706 C_644458 C_666624 C_729287 C_762826 C_608129 C_620926 C_130940 C_154279 C_716980 C_651717 C_629822 C_154807 C_601697 C_673992 C_570947 C_687518 C_292429 C_644510 C_575270 C_450639 C_671646 C_724405 C_115223 C_722043 C_788495 C_649950 C_112669 C_633391 C_76315 C_636394 C_757190 C_728103 C_647693 C_685413 C_795460 C_629799 C_205725 C_576693 C_658267 C_606098 C_761790 C_497874 C_579596 C_670588 C_666273 C_691447 C_704778 C_752287 C_89990 C_462248 C_617885 C_710539 C_562880 C_634065 C_709598 C_2781 C_720950 C_785513 C_204038 C_561735 C_378760 C_772339 C_794700 C_61494 C_224473 C_794782 C_724585 C_742857 C_288183 C_765795 C_690309 C_739283 C_79314 C_162724 C_648725 C_667231 C_794053 C_745575 C_141322 C_582246 C_748554 C_710682 C_612742 C_720173 C_502243 C_174143 C_627400 C_710528 C_379729 C_606005 C_677002 C_802271 C_704185 C_562028 C_561725 C_553396 C_785636 C_691319 C_796794 C_300619 C_668005 C_694751 C_549270 C_569058 C_174156 C_28137 C_601784 C_759473 C_239272 C_605100 C_796859 C_3658 C_711325
#174	C_70736	C_792993 C_784151 C_799725 C_799311 C_795700 C_784572 C_787762 C_799982 C_802024 C_795556 C_784567 C_781745 C_795030 C_802528 C_782392 C_773364 C_773154 C_777642 C_788645 C_783975 C_775317 C_775297 C_781425 C_793041 C_779642 C_793094 C_794643 C_802674 C_774676 C_801706 C_772687 C_777862 C_772012 C_792579 C_800510 C_780929 C_774592 C_785818 C_780486 C_773965 C_799630 C_802837 C_774252 C_790984 C_788588 C_771187 C_786487 C_775194 C_787445 C_782480 C_774068 C_790093 C_791074 C_794317 C_780846 C_780005 C_795218 C_787905 C_781620 C_787749 C_776950 C_781692 C_779002 C_782432 C_790576 C_776269 C_794733 C_779900 C_781786 C_800621 C_802367 C_780831 C_772066 C_776183 C_802184 C_784225 C_776051 C_777715 C_785026 C_795637 C_776627 C_784685 C_799953 C_802191 C_794666 C_772282 C_785477 C_783124 C_793823 C_776630 C_791231 C_791697 C_781088 C_794065 C_782655 C_772643 C_774736 C_772857 C_779892 C_788259 C_795200 C_802549 C_776870 C_776097 C_791564 C_772129 C_778729 C_803051 C_791410 C_793057 C_795241 C_777196 C_781306 C_789105 C_779631 C_789109 C_799086 C_779878 C_778760 C_783012 C_783568 C_790158 C_787027 C_776623 C_794074 C_789166 C_788089 C_776125 C_779985 C_780591 C_775096 C_801381 C_772423 C_793105 C_787292 C_802132 C_790416 C_774959 C_782752 C_800251 C_779593 C_780345 C_799671 C_771715 C_783837 C_782767 C_787881 C_785540 C_783737 C_771968 C_783877 C_792393 C_782862 C_789443 C_799242 C_792716 C_802448 C_779007 C_782402 C_772809 C_781476 C_784111 C_790642 C_786100 C_773265 C_795939 C_784089 C_794662 C_780974 C_777708 C_778532 C_792526 C_779989 C_775808


open IN, "$file_in"     or die "Can't open $file_in $!";
open OUT,">$file_out";

my %linju;

while (<IN>) {
    chomp;
    my @s =split /\t/,$_;
    $linju{$s[1]} = $s[2];
}

close IN;

my %group;


open IN, "$file_in"     or die "Can't open $file_in $!";
while (<IN>) {
    chomp;
    my @s = split /\t/,$_;
    if (exists $group{$s[1]}) {
        next;
    }
    else {
        my @ss =split /\s/,$s[2];
        print OUT "$s[0]\t$s[1]\t";
        $group{$s[1]} = 1;
        for (my $k = 0;$k<scalar @ss ;$k++) {
            unless (exists $group{$ss[$k]}) {
                $group{$ss[$k]} = 1;
                print OUT "$ss[$k] ";
                if (exists $linju{$ss[$k]}) {
                
                    my @sss = split /\s/,$linju{$ss[$k]};
                    for (my $k = 0;$k<scalar @sss ;$k++) {
                        unless (exists $group{$sss[$k]}) {
                            $group{$sss[$k]} = 1;
                            print OUT "$sss[$k] ";
                        }
                    }
                }
            }
        }
        print OUT "\n";
        
    }
}






